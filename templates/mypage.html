<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Park Review</title>

    <!-- Ï†úÏù¥ÏøºÎ¶¨ -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Î∂ÄÌä∏Ïä§Ìä∏Îû© -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>



    <script>
        $(document).ready(function () {
            // get_parks_list("all")
        })

        function get_parks_list(parkId) {
            location.href=`/mypage/myParks/${parkId}`
            // $.ajax({
            //     type: "GET",
            //     url: `mypage/myParks/${parkId}`,
            //     data: {},
            //     success: function (response) {
            
            //     }
            // })
        }

        function get_parks_reviews(parkId) {
            location.href=`/mypage/myReviews/${parkId}`
            // $.ajax({
            //     type: "GET",
            //     url: `mypage/myReviews/${parkId}`,
            //     data: {},
            //     success: function (response) {
            //     }
            // })
        }
        
        // $(document).ready(function () {
        //     $("#header").load("templates/header.html");  // ÏõêÌïòÎäî ÌååÏùº Í≤ΩÎ°úÎ•º ÏÇΩÏûÖÌïòÎ©¥ ÎêúÎã§
        //     $("#footer").load("./footer");  // Ï∂îÍ∞Ä Ïù∏ÌÅ¥Î£®ÎìúÎ•º ÏõêÌï† Í≤ΩÏö∞ Ïù¥Îü∞ÏãùÏúºÎ°ú Ï∂îÍ∞Ä
        // });
    </script>
    <style>
        ul,
        li {
            list-style: none;
            padding: 0;
            margin: 0;
            color: inherit;
        }

        li {
            padding: 20px;
            text-align: center;
            border: 1px solid #555;
        }

        .role-button {
            cursor: pointer;
            transition: all 0.2s;
        }

        .role-button:hover {
            background: #eee;
        }

        .myPark {
            margin-top: 30px;
        }

        .parks,
        .reviews {
            justify-content: center;
            gap: 10px;
            padding-top: 20px;
        }
        .reviews > * {
            width: 70%;
        }

        .mypage-contents {
            display: flex;
        }

        .mypage-contents aside {
            flex: 1 1 20%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .mypage-contents .myPark {
            flex: 1 1 80%;
        }

        .selectCard {
            display: flex;
            padding: 0 3em;
        }

        .selectCard>* {
            flex: 1 1 33%;
        }
        .card-body {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .weather-box {
            height: 150px;
            width: 150px;
            text-align: center;
            background: pink;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header id="header"></header>
        <section class="mypage-contents">
            <aside>
                <ul>
                    <li>ÏïàÎÖïÌïòÏÑ∏Ïöî.
                        <strong>{{ user.userName }}</strong>Îãò
                        <br>
                        {{ user.email }}
                        <hr>
                        ÎÇòÏùò Î¶¨Î∑∞ ÌôïÏù∏ÌïòÍ∏∞ ‚ñº
                    </li>
                    <li class="role-button" onclick="get_parks_reviews('all')">
                        Í≥µÏõê Ï†ÑÏ≤¥ Î¶¨Î∑∞
                    </li>
                    {% for park in parks %}
                        <li class="role-button" onclick="get_parks_reviews('{{ park.parkId }}')">
                            {{ park.parkName }}
                        </li>
                    {% endfor %}
                </ul>
            </aside>
            <div class="myPark">
                <div class="selectCard">
                    <div class="card text-center role-button" onclick="get_parks_list('all')">
                        <div class="card-body">
                            Ï†ÑÏ≤¥ Í≥µÏõê
                        </div>
                    </div>
                    <div class="card text-center role-button" onclick="get_parks_list('finished')">
                        <div class="card-body">
                            üèÅ ÏôÑÏ£º Í≥µÏõê
                        </div>
                    </div>
                    <div class="card text-center role-button" onclick="get_parks_list('favorite')">
                        <div class="card-body">
                            ‚ù§ Ï¶êÍ≤®Ï∞æÎäî Í≥µÏõê
                        </div>
                    </div>
                </div>
                <hr>
                <!-- Í≥µÏõê -->
                {% if 'parkId' in currList[0] %}
                <div class="parks row">
                    {% for park in currList %}
                        <!-- Ï¶êÍ≤®Ï∞æÍ∏∞ -->
                        {% if parkId == "favorite" %}
                            {% for check in user.parkCheck %}
                                {% if check.parkId == park.parkId %}
                                    {% if check.favorite == 1 %}
                                        <div class="card text-center" style="width: 30%;">
                                            <div class="card-body">
                                                <div>
                                                    <h5 class="card-title">
                                                        ‚ù§
                                                        <br>
                                                        {{ park.parkName }}
                                                    </h5>
                                                    <p class="card-text">
                                                        {{ park.parkLocation }}
                                                        <hr>
                                                        {{ park.parkDesc }}
                                                    </p>
                                                </div>
                                                <a href="/park/{{ park.parkId }}" class="btn btn-primary">Í≥µÏõê Ï†ïÎ≥¥</a>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        <!-- ÏôÑÏ£º -->
                        {% if parkId == "finished" %}
                            {% for check in user.parkCheck %}
                                {% if check.parkId == park.parkId %}
                                    {% if check.finished == 1 %}
                                        <div class="card text-center" style="width: 30%;">
                                            <div class="card-body">
                                                <div>
                                                    <h5 class="card-title">
                                                        üèÅ
                                                        <br>
                                                        {{ park.parkName }}
                                                    </h5>
                                                    <p class="card-text">
                                                        {{ park.parkLocation }}
                                                        <hr>
                                                        {{ park.parkDesc }}
                                                    </p>
                                                </div>
                                                <a href="/park/{{ park.parkId }}" class="btn btn-primary">Í≥µÏõê Ï†ïÎ≥¥</a>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        <!-- Ï†ÑÏ≤¥ -->
                        {% if parkId == "all" %}
                        <div class="card text-center" style="width: 30%;">
                            <div class="card-body">
                                <div>
                                    <h5 class="card-title">
    
                                        {% for check in user.parkCheck %}
                                            {% if check.parkId == park.parkId %}
                                                {% if check.favorite == 1 %}
                                                    ‚ù§
                                                {% endif %}
                                                {% if check.finished == 1 %}
                                                    üèÅ
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                        <br>
                                        {{ park.parkName }}
                                    </h5>
                                    <p class="card-text">
                                        {{ park.parkLocation }}
                                        <hr>
                                        {{ park.parkDesc }}
                                    </p>
                                </div>
                                <a href="/park/{{ park.parkId }}" class="btn btn-primary">Í≥µÏõê Ï†ïÎ≥¥</a>
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
                {% endif %}
                <!-- Î¶¨Î∑∞ -->
                {% if 'reviewId' in currList %}
                <div class="reviews row">
                    <!-- Î¶¨Î∑∞ Ï†ÑÏ≤¥ -->
                    {% if parkId == 'all' %}
                        {% for review in currList['reviews'] %}
                            {% for park in parks %}
                                {% if park.parkId == review.parkId %}
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title">
                                            {{ review.comment }}
                                        </h5>
                                        <p class="card-text">
                                            {{ park.parkName }}
                                            |
                                            {{ review.weather }}
                                            |
                                            rate: {{review.rate}}
                                            {% if review.rate == 5 %}
                                                {{ "‚≠ê" * 5 }}
                                            {% elif review.rate == 4 %}
                                                {{ "‚≠ê" * 4 }}
                                            {% elif review.rate == 3 %}
                                                {{ "‚≠ê" * 3 }}
                                            {% elif review.rate == 2 %}
                                                {{ "‚≠ê" * 2 }}
                                            {% elif review.rate == 1 %}
                                                {{ "‚≠ê" * 1 }}
                                            {% else %}
                                                üò°
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    {% else %}
                    <!-- Î¶¨Î∑∞ Í≥µÏõêÎ≥Ñ -->
	                <!-- parkIdÍ∞Ä allÏù¥ ÏïÑÎãàÎùº Í≥µÏõêÏùò idÍ∞íÏùº Îïå -->
                    <!-- forÎ¨∏ÏúºÎ°ú reviewsÏùò review Î∞∞Ïó¥ÏùÑ ÎèåÎ¶¨ÎäîÎç∞ -->
                    <!-- ÌòÑÏû¨ reviewÏùò parkIdÍ∞íÍ≥º ÌòÑÏû¨ ÌéòÏù¥ÏßÄÏùò idÍ∞íÏù¥ Í∞ôÏúºÎ©¥ Îß§ÏπòÎêòÎäî Î¶¨Ïä§Ìä∏Ïù∏Îç∞ -->
                    <!-- ÏúÑÏùò Í∞íÏù¥ parkIdÏùò Í≥µÏõê idÍ∞íÍ≥º Í∞ôÎã§Î©¥ Ï∂úÎ†•ÌïúÎã§.-->

                    {% set pageId= parkId | int %}
                    {% for review in currList['reviews'] %} 
                        {% if review.parkId - pageId == 0 %}
                            {% for park in parks %}
                                {% if park.parkId == review.parkId %}
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title">
                                            {{ review.comment }}
                                        </h5>
                                        <p class="card-text">
                                            {{ park.parkName }}
                                            |
                                            {{ review.weather }}
                                            |
                                            rate: {{review.rate}}
                                            {% if review.rate == 5 %}
                                                {{ "‚≠ê" * 5 }}
                                            {% elif review.rate == 4 %}
                                                {{ "‚≠ê" * 4 }}
                                            {% elif review.rate == 3 %}
                                                {{ "‚≠ê" * 3 }}
                                            {% elif review.rate == 2 %}
                                                {{ "‚≠ê" * 2 }}
                                            {% elif review.rate == 1 %}
                                                {{ "‚≠ê" * 1 }}
                                            {% else %}
                                                üò°
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}

                        {% endif %}
                    {% endfor %}
                {% endif %}
                </div>
                {% endif %}
            </div>
        </section>
        <footer id="footer">

            <!-- ÏΩîÎìú ÏÉòÌîå -->
            <!-- <div class="weather-box">
                <div id="weather" class="weather"></div>
            </div> -->
            <script>
                const API_KEY='a2e8922539a2e4f37866cc7d173c8be2'
                const weatherResetTime=10*60*1000

                setInterval(()=>{
                    askForCoords();
                }, weatherResetTime)

                askForCoords();
                function askForCoords() {
                    navigator.geolocation.getCurrentPosition(handleGeoSucces, handleGeoError);
                }

                function handleGeoSucces(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    getWeather(latitude, longitude);
                }

                function handleGeoError() {
                    console.log('ÏúÑÏπòÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                }

                function getWeather(lat, lon) {
                    fetch
                    fetch(
                            `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`
                        )
                        .then((response)=>{
                            return response.json();
                        })
                        .then((json)=>{
                            const temparature = json.main.temp;
                            const place = json.name;
                            const string = json.weather[0].main.toLowerCase();
                            console.log(string.toLowerCase());
                            const icon = json.weather[0].icon;

                            weather.innerHTML =
                                `
                            <strong>${temparature.toFixed(1)}‚ÑÉ</strong>
                            <img src="http://openweathermap.org/img/wn/${icon}@2x.png" />`;
                        });
                }
            </script>
            <!-- ÏΩîÎìú ÏÉòÌîå -->


        </footer>
    </div>
</body>

</html>
